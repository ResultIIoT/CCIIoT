<html>
<head>
    <title>NiCad6 Clone Report</title>
    <style type="text/css">
        body {font-family:sans-serif;}
        table {background-color:white; border:0px; padding:0px; border-spacing:4px; width:auto; margin-left:30px; margin-right:auto;}
        td {background-color:rgba(192,212,238,0.8); border:0px; padding:8px; width:auto; vertical-align:top; border-radius:8px}
        pre {background-color:white; padding:4px;}
        a {color:darkblue;}
    </style>
</head>
<body>
<h2>NiCad6 Clone Report</h2>
<table>
<tr style="font-size:14pt">
<td><b>System:</b> &nbsp; volttron</td>
<td><b>Clone pairs:</b> &nbsp; 53</td>
<td><b>Clone classes:</b> &nbsp; 29</td>
</tr>
<tr style="font-size:12pt">
<td style="background-color:white">Clone type: &nbsp; 1</td>
<td style="background-color:white">Granularity: &nbsp; functions</td>
<td style="background-color:white">Max diff threshold: &nbsp; 0%</td>
<td style="background-color:white">Clone size: &nbsp; 5 - 2500 lines</td>
<td style="background-color:white">Total functions: &nbsp; 2905</td>
</tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 1:</b> &nbsp; 3 fragments, nominal size 6 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag78')" href="javascript:;">
volttron/deprecated/OpenEISHistorian/openeis/historian.py: 176-186
</a>
<div class="mid" id="frag78" style="display:none"><pre>
def main(argv=sys.argv):
    """
    Main method called by the eggsecutable.
    """
    try:
        utils.vip_main(historian, version=__version__)
    except Exception as e:
        print(e)
        _log.exception('unhandled exception')


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag864')" href="javascript:;">
volttron/services/core/MQTTHistorian/mqtt_historian/agent.py: 148-155
</a>
<div class="mid" id="frag864" style="display:none"><pre>
def main(argv=sys.argv):
    try:
        utils.vip_main(historian, version=__version__)
    except Exception as e:
        print(e)
        _log.exception('unhandled exception')


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag478')" href="javascript:;">
volttron/services/contrib/InfluxdbHistorian/influx/historian.py: 379-389
</a>
<div class="mid" id="frag478" style="display:none"><pre>
def main(argv=sys.argv):
    """Main method called by the eggsecutable.
    @param argv:
    """
    try:
        utils.vip_main(historian, version=__version__)
    except Exception as e:
        print(e)
        _log.exception('unhandled exception')


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 2:</b> &nbsp; 2 fragments, nominal size 6 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag198')" href="javascript:;">
volttron/examples/ListenerAgent/listener/agent.py: 118-125
</a>
<div class="mid" id="frag198" style="display:none"><pre>
def main(argv=sys.argv):
    '''Main method called by the eggsecutable.'''
    try:
        utils.vip_main(ListenerAgent, version=__version__)
    except Exception as e:
        _log.exception('unhandled exception')


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1020')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/platform_driver/interfaces/modbus_tk/tests/modbus_listener_agent.py: 149-156
</a>
<div class="mid" id="frag1020" style="display:none"><pre>
def main(argv=sys.argv):
    '''Main method called by the eggsecutable.'''
    try:
        utils.vip_main(ListenerAgent, version=__version__)
    except Exception as e:
        _log.exception('unhandled exception')


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 3:</b> &nbsp; 2 fragments, nominal size 5 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag201')" href="javascript:;">
volttron/examples/MarketAgents/AHUAgent/ahu/agent.py: 113-118
</a>
<div class="mid" id="frag201" style="display:none"><pre>
    def setup(self, sender, **kwargs):
        _log.debug('Subscribing to '+self.subscribing_topic)
        self.vip.pubsub.subscribe(peer='pubsub',
                                  prefix=self.subscribing_topic,
                                  callback=self.updateState)
								  
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag250')" href="javascript:;">
volttron/examples/MarketAgents/VAVAgent/vav/agent.py: 127-132
</a>
<div class="mid" id="frag250" style="display:none"><pre>
    def setup(self, sender, **kwargs):
        _log.debug('Subscribing to '+self.subscribing_topic)
        self.vip.pubsub.subscribe(peer='pubsub',
                                  prefix=self.subscribing_topic,
                                  callback=self.updateState)
		
</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 4:</b> &nbsp; 2 fragments, nominal size 7 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag308')" href="javascript:;">
volttron/examples/StandAloneFileWatcher/standalonefilewatchpublisher.py: 63-70
</a>
<div class="mid" id="frag308" style="display:none"><pre>
    def read_file(self, file):
        _log.debug('loading file %s', file)
        with open(file, 'r') as f:
            f.seek(self.file_end_position[file])
            for line in f:
                self.publish_file(line.strip(),self.file_topic[file])
            self.file_end_position[file] = self.get_end_position(f)

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1402')" href="javascript:;">
volttron/services/ops/FileWatchPublisher/filewatchpublisher/agent.py: 126-133
</a>
<div class="mid" id="frag1402" style="display:none"><pre>
    def read_file(self, file):
        _log.debug('loading file %s', file)
        with open(file, 'r') as f:
            f.seek(self.file_end_position[file])
            for line in f:
                self.publish_file(line.strip(),self.file_topic[file])
            self.file_end_position[file] = self.get_end_position(f)

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 5:</b> &nbsp; 3 fragments, nominal size 9 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag559')" href="javascript:;">
volttron/services/contrib/MarketServiceAgent/tests/test_offer.py: 59-67
</a>
<div class="mid" id="frag559" style="display:none"><pre>
def create_demand_curve():
    demand_curve = PolyLine()
    price = 0
    quantity = 1000
    demand_curve.add(Point(price, quantity))
    price = 1000
    quantity = 0
    demand_curve.add(Point(price, quantity))
    return demand_curve
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2594')" href="javascript:;">
volttron/volttrontesting/platform/base_market_agent/test_poly_line_factory.py: 94-102
</a>
<div class="mid" id="frag2594" style="display:none"><pre>
def create_demand_curve():
    demand_curve = PolyLine()
    price = 0
    quantity = 1000
    demand_curve.add(Point(price,quantity))
    price = 1000
    quantity = 0
    demand_curve.add(Point(price,quantity))
    return demand_curve
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2589')" href="javascript:;">
volttron/volttrontesting/platform/base_market_agent/test_poly_line.py: 166-174
</a>
<div class="mid" id="frag2589" style="display:none"><pre>
def create_demand_curve():
    demand_curve = PolyLine()
    price = 0
    quantity = 1000
    demand_curve.add(Point(price,quantity))
    price = 1000
    quantity = 0
    demand_curve.add(Point(price,quantity))
    return demand_curve
</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 6:</b> &nbsp; 2 fragments, nominal size 9 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag618')" href="javascript:;">
volttron/services/core/DataMover/tests/test_datamover.py: 83-98
</a>
<div class="mid" id="frag618" style="display:none"><pre>
def publish_agent(request, volttron_instances, forwarder):
    global volttron_instance1, volttron_instance2
    # 1: Start a fake agent to publish to message bus
    agent = volttron_instance1.build_agent(identity='test-agent')

    # 2: add a tear down method to stop sqlhistorian agent and the fake
    # agent that published to message bus
    def stop_agent():
        print("In teardown method of publish_agent")
        if isinstance(agent, Agent):
            agent.core.stop()

    request.addfinalizer(stop_agent)
    return agent


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag804')" href="javascript:;">
volttron/services/core/ForwardHistorian/tests/test_forward_historian.py: 90-106
</a>
<div class="mid" id="frag804" style="display:none"><pre>
def publish_agent(request, volttron_instances, forwarder):
    global volttron_instance1, volttron_instance2

    # 1: Start a fake agent to publish to message bus
    agent = volttron_instance1.build_agent(identity='test-agent')

    # 2: add a tear down method to stop sqlhistorian agent and the fake
    # agent that published to message bus
    def stop_agent():
        print("In teardown method of publish_agent")
        if isinstance(agent, Agent):
            agent.core.stop()

    request.addfinalizer(stop_agent)
    return agent


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 7:</b> &nbsp; 2 fragments, nominal size 7 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag620')" href="javascript:;">
volttron/services/core/DataMover/tests/test_datamover.py: 100-112
</a>
<div class="mid" id="frag620" style="display:none"><pre>
def query_agent(request, volttron_instances, sqlhistorian):
    # 1: Start a fake agent to query the sqlhistorian in volttron_instance2
    agent = volttron_instance2.build_agent()

    # 2: add a tear down method to stop sqlhistorian agent and the fake agent that published to message bus
    def stop_agent():
        print("In teardown method of module")
        agent.core.stop()

    request.addfinalizer(stop_agent)
    return agent


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag806')" href="javascript:;">
volttron/services/core/ForwardHistorian/tests/test_forward_historian.py: 108-121
</a>
<div class="mid" id="frag806" style="display:none"><pre>
def query_agent(request, volttron_instances, sqlhistorian):
    # 1: Start a fake agent to query the sqlhistorian in volttron_instance2
    agent = volttron_instance2.build_agent()

    # 2: add a tear down method to stop sqlhistorian agent and the fake
    # agent that published to message bus
    def stop_agent():
        print("In teardown method of module")
        agent.core.stop()

    request.addfinalizer(stop_agent)
    return agent


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 8:</b> &nbsp; 2 fragments, nominal size 9 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag622')" href="javascript:;">
volttron/services/core/DataMover/tests/test_datamover.py: 114-126
</a>
<div class="mid" id="frag622" style="display:none"><pre>
def sqlhistorian(request, volttron_instances):
    global volttron_instance1, volttron_instance2
    global sqlite_config
    # 1: Install historian agent
    # Install and start sqlhistorian agent in instance2
    agent_uuid = volttron_instance2.install_agent(
        agent_dir=get_services_core("SQLHistorian"),
        config_file=sqlite_config,
        start=True,
        vip_identity='platform.historian')
    print("sqlite historian agent id: ", agent_uuid)


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag808')" href="javascript:;">
volttron/services/core/ForwardHistorian/tests/test_forward_historian.py: 123-136
</a>
<div class="mid" id="frag808" style="display:none"><pre>
def sqlhistorian(request, volttron_instances):
    global volttron_instance1, volttron_instance2
    global sqlite_config

    # 1: Install historian agent
    # Install and start sqlhistorian agent in instance2
    agent_uuid = volttron_instance2.install_agent(
        agent_dir=get_services_core("SQLHistorian"),
        config_file=sqlite_config,
        start=True,
        vip_identity='platform.historian')
    print("sqlite historian agent id: ", agent_uuid)


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 9:</b> &nbsp; 2 fragments, nominal size 8 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag624')" href="javascript:;">
volttron/services/core/DataMover/tests/test_datamover.py: 154-163
</a>
<div class="mid" id="frag624" style="display:none"><pre>
def publish(publish_agent, topic, header, message):
    if isinstance(publish_agent, Agent):
        publish_agent.vip.pubsub.publish('pubsub',
                                         topic,
                                         headers=header,
                                         message=message).get(timeout=10)
    else:
        publish_agent.publish_json(topic, header, message)


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag810')" href="javascript:;">
volttron/services/core/ForwardHistorian/tests/test_forward_historian.py: 165-174
</a>
<div class="mid" id="frag810" style="display:none"><pre>
def publish(publish_agent, topic, header, message):
    if isinstance(publish_agent, Agent):
        publish_agent.vip.pubsub.publish('pubsub',
                                         topic,
                                         headers=header,
                                         message=message).get(timeout=10)
    else:
        publish_agent.publish_json(topic, header, message)


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 10:</b> &nbsp; 2 fragments, nominal size 34 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag628')" href="javascript:;">
volttron/services/core/DataMover/tests/test_datamover.py: 314-377
</a>
<div class="mid" id="frag628" style="display:none"><pre>
def test_analysis_topic(publish_agent, query_agent):
    """
    Test if devices topic message is getting forwarded to historian running on
    another instance. Test if topic name substitutions happened.
    Publish to topic
    'analysis/PNNL/BUILDING_1/Device/MixedAirTemperature' in volttron_instance1 and
    query for topic
    'PNNL/BUILDING1_ANON/Device/MixedAirTemperature' in volttron_instance2
    :param publish_agent: Fake agent used to publish messages to bus in
    volttron_instance1. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance1 and forwareder
    agent and returns the  instance of fake agent to publish
    :param query_agent: Fake agent used to query sqlhistorian in
    volttron_instance2. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance2 and sqlhistorian
    agent and returns the instance of a fake agent to query the historian
    """
    print("\n** test_analysis_topic **")
    # Publish fake data. The format mimics the format used by VOLTTRON drivers.
    # Make some random readings
    oat_reading = random.uniform(30, 100)
    mixed_reading = oat_reading + random.uniform(-5, 5)
    damper_reading = random.uniform(0, 100)

    # Create a message for all points.
    all_message = [{'OutsideAirTemperature': oat_reading,
                    'MixedAirTemperature': mixed_reading,
                    'DamperSignal': damper_reading},
                   {'OutsideAirTemperature': {'units': 'F', 'tz': 'UTC',
                                              'type': 'float'},
                    'MixedAirTemperature': {'units': 'F', 'tz': 'UTC',
                                            'type': 'float'},
                    'DamperSignal': {'units': '%', 'tz': 'UTC',
                                     'type': 'float'}
                    }]

    # Create timestamp
    now = utils.format_timestamp(datetime.utcnow())
    print("now is ", now)
    headers = {
        headers_mod.DATE: now,
        headers_mod.TIMESTAMP: now
    }
    # Publish messages
    publish(publish_agent, 'analysis/PNNL/BUILDING_1/Device', headers, all_message)
    gevent.sleep(0.5)

    # pytest.set_trace()
    # Query the historian
    result = query_agent.vip.rpc.call(
        'platform.historian',
        'query',
        topic='PNNL/BUILDING1_ANON/Device/MixedAirTemperature',
        start=now,
        order="LAST_TO_FIRST").get(timeout=10)
    print('Query Result', result)
    assert (len(result['values']) == 1)
    (now_date, now_time) = now.split("T")
    if now_time[-1:] == 'Z':
        now_time = now_time[:-1]
    assert (result['values'][0][0] == now_date + 'T' + now_time + '+00:00')
    assert (result['values'][0][1] == approx(mixed_reading))


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag812')" href="javascript:;">
volttron/services/core/ForwardHistorian/tests/test_forward_historian.py: 226-289
</a>
<div class="mid" id="frag812" style="display:none"><pre>
def test_analysis_topic(publish_agent, query_agent):
    """
    Test if devices topic message is getting forwarded to historian running on
    another instance. Test if topic name substitutions happened.
    Publish to topic
    'analysis/PNNL/BUILDING_1/Device/MixedAirTemperature' in volttron_instance1 and
    query for topic
    'PNNL/BUILDING1_ANON/Device/MixedAirTemperature' in volttron_instance
    @param publish_agent: Fake agent used to publish messages to bus in
    volttron_instance1. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance1 and forwareder
    agent and returns the  instance of fake agent to publish
    @param query_agent: Fake agent used to query sqlhistorian in
    volttron_instance. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance and sqlhistorian
    agent and returns the instance of a fake agent to query the historian
    """
    print("\n** test_analysis_topic **")
    # Publish fake data. The format mimics the format used by VOLTTRON drivers.
    # Make some random readings
    oat_reading = random.uniform(30, 100)
    mixed_reading = oat_reading + random.uniform(-5, 5)
    damper_reading = random.uniform(0, 100)

    # Create a message for all points.
    all_message = [{'OutsideAirTemperature': oat_reading,
                    'MixedAirTemperature': mixed_reading,
                    'DamperSignal': damper_reading},
                   {'OutsideAirTemperature': {'units': 'F', 'tz': 'UTC',
                                              'type': 'float'},
                    'MixedAirTemperature': {'units': 'F', 'tz': 'UTC',
                                            'type': 'float'},
                    'DamperSignal': {'units': '%', 'tz': 'UTC',
                                     'type': 'float'}
                    }]

    # Create timestamp
    now = utils.format_timestamp(datetime.utcnow())
    print("now is ", now)
    headers = {
        headers_mod.DATE: now,
        headers_mod.TIMESTAMP: now
    }
    # Publish messages
    publish(publish_agent, 'analysis/PNNL/BUILDING_1/Device', headers, all_message)
    gevent.sleep(0.5)

    # pytest.set_trace()
    # Query the historian
    result = query_agent.vip.rpc.call(
        'platform.historian',
        'query',
        topic='PNNL/BUILDING1_ANON/Device/MixedAirTemperature',
        start=now,
        order="LAST_TO_FIRST").get(timeout=10)
    print('Query Result', result)
    assert (len(result['values']) == 1)
    (now_date, now_time) = now.split("T")
    if now_time[-1:] == 'Z':
        now_time = now_time[:-1]
    assert (result['values'][0][0] == now_date + 'T' + now_time + '+00:00')
    assert (result['values'][0][1] == approx(mixed_reading))


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 11:</b> &nbsp; 2 fragments, nominal size 27 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag629')" href="javascript:;">
volttron/services/core/DataMover/tests/test_datamover.py: 380-436
</a>
<div class="mid" id="frag629" style="display:none"><pre>
def test_analysis_topic_no_header(publish_agent, query_agent):
    """
    Test if devices topic message is getting forwarded to historian running on
    another instance. Test if topic name substitutions happened.
    Publish to topic
    'analysis/PNNL/BUILDING_1/Device/MixedAirTemperature' in volttron_instance1 and
    query for topic
    'PNNL/BUILDING1_ANON/Device/MixedAirTemperature' in volttron_instance2
    :param publish_agent: Fake agent used to publish messages to bus in
    volttron_instance1. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance1 and forwareder
    agent and returns the  instance of fake agent to publish
    :param query_agent: Fake agent used to query sqlhistorian in
    volttron_instance2. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance2 and sqlhistorian
    agent and returns the instance of a fake agent to query the historian
    """
    print("\n** test_analysis_topic **")
    # Publish fake data. The format mimics the format used by VOLTTRON drivers.
    # Make some random readings
    oat_reading = random.uniform(30, 100)
    mixed_reading = oat_reading + random.uniform(-5, 5)
    damper_reading = random.uniform(0, 100)

    # Create a message for all points.
    all_message = [{'OutsideAirTemperature': oat_reading,
                    'MixedAirTemperature': mixed_reading,
                    'DamperSignal': damper_reading},
                   {'OutsideAirTemperature': {'units': 'F', 'tz': 'UTC',
                                              'type': 'float'},
                    'MixedAirTemperature': {'units': 'F', 'tz': 'UTC',
                                            'type': 'float'},
                    'DamperSignal': {'units': '%', 'tz': 'UTC',
                                     'type': 'float'}
                    }]

    # Create timestamp
    now = datetime.utcnow().isoformat() + 'Z'
    print("now is ", now)

    # Publish messages
    publish(publish_agent, 'analysis/PNNL/BUILDING_1/Device', None, all_message)
    gevent.sleep(0.5)

    # pytest.set_trace()
    # Query the historian
    result = query_agent.vip.rpc.call(
        'platform.historian',
        'query',
        topic='PNNL/BUILDING1_ANON/Device/MixedAirTemperature',
        start=now,
        order="LAST_TO_FIRST").get(timeout=10)
    print('Query Result', result)
    assert (len(result['values']) == 1)
    assert (result['values'][0][1] == approx(mixed_reading))


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag813')" href="javascript:;">
volttron/services/core/ForwardHistorian/tests/test_forward_historian.py: 292-348
</a>
<div class="mid" id="frag813" style="display:none"><pre>
def test_analysis_topic_no_header(publish_agent, query_agent):
    """
    Test if devices topic message is getting forwarded to historian running on
    another instance. Test if topic name substitutions happened.
    Publish to topic
    'analysis/PNNL/BUILDING_1/Device/MixedAirTemperature' in volttron_instance1 and
    query for topic
    'PNNL/BUILDING1_ANON/Device/MixedAirTemperature' in volttron_instance
    @param publish_agent: Fake agent used to publish messages to bus in
    volttron_instance1. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance1 and forwareder
    agent and returns the  instance of fake agent to publish
    @param query_agent: Fake agent used to query sqlhistorian in
    volttron_instance. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance and sqlhistorian
    agent and returns the instance of a fake agent to query the historian
    """
    print("\n** test_analysis_topic **")
    # Publish fake data. The format mimics the format used by VOLTTRON drivers.
    # Make some random readings
    oat_reading = random.uniform(30, 100)
    mixed_reading = oat_reading + random.uniform(-5, 5)
    damper_reading = random.uniform(0, 100)

    # Create a message for all points.
    all_message = [{'OutsideAirTemperature': oat_reading,
                    'MixedAirTemperature': mixed_reading,
                    'DamperSignal': damper_reading},
                   {'OutsideAirTemperature': {'units': 'F', 'tz': 'UTC',
                                              'type': 'float'},
                    'MixedAirTemperature': {'units': 'F', 'tz': 'UTC',
                                            'type': 'float'},
                    'DamperSignal': {'units': '%', 'tz': 'UTC',
                                     'type': 'float'}
                    }]

    # Create timestamp
    now = datetime.utcnow().isoformat() + 'Z'
    print("now is ", now)

    # Publish messages
    publish(publish_agent, 'analysis/PNNL/BUILDING_1/Device', None, all_message)
    gevent.sleep(0.5)

    # pytest.set_trace()
    # Query the historian
    result = query_agent.vip.rpc.call(
        'platform.historian',
        'query',
        topic='PNNL/BUILDING1_ANON/Device/MixedAirTemperature',
        start=now,
        order="LAST_TO_FIRST").get(timeout=10)
    print('Query Result', result)
    assert (len(result['values']) == 1)
    assert (result['values'][0][1] == approx(mixed_reading))


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 12:</b> &nbsp; 2 fragments, nominal size 26 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag630')" href="javascript:;">
volttron/services/core/DataMover/tests/test_datamover.py: 439-497
</a>
<div class="mid" id="frag630" style="display:none"><pre>
def test_log_topic(publish_agent, query_agent):
    """
    Test if log topic message is getting forwarded to historian running on
    another instance. Test if topic name substitutions happened.
    Publish to topic
    'datalogger/PNNL/BUILDING_1/Device' in volttron_instance1 and
    query for topic
    'datalogger/PNNL/BUILDING1_ANON/Device/MixedAirTemperature' in
    volttron_instance2
    Expected result:
     Record should get entered into database with current time at time of
     insertion and should ignore timestamp in header. Topic name
     substitution should have happened
    :param publish_agent: Fake agent used to publish messages to bus in
    volttron_instance1. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance1 and forwareder
    agent and returns the  instance of fake agent to publish
    :param query_agent: Fake agent used to query sqlhistorian in
    volttron_instance2. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance2 and sqlhistorian
    agent and returns the instance of a fake agent to query the historian
    """
    print("\n** test_log_topic **")
    # Publish fake data. The format mimics the format used by VOLTTRON drivers.
    # Make some random readings
    oat_reading = random.uniform(30, 100)
    mixed_reading = oat_reading + random.uniform(-5, 5)

    # Create a message for all points.
    message = {'MixedAirTemperature': {'Readings': mixed_reading,
                                       'Units': 'F',
                                       'tz': 'UTC',
                                       'type': 'float'}}
    # Create timestamp
    current_time = utils.format_timestamp(datetime.utcnow())
    print("current_time is ", current_time)
    future_time = '2017-12-02T00:00:00'
    headers = {
        headers_mod.DATE: future_time,
        headers_mod.TIMESTAMP: future_time
    }
    print("time in header is ", future_time)

    # Publish messages
    publish(publish_agent, "datalogger/PNNL/BUILDING_1/Device", headers, message)
    gevent.sleep(1)

    # Query the historian
    result = query_agent.vip.rpc.call(
        'platform.historian',
        'query',
        start=current_time,
        topic="datalogger/PNNL/BUILDING1_ANON/Device/MixedAirTemperature",
        order="LAST_TO_FIRST").get(timeout=10)
    print('Query Result', result)
    assert (len(result['values']) == 1)
    assert (result['values'][0][1] == approx(mixed_reading))


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag814')" href="javascript:;">
volttron/services/core/ForwardHistorian/tests/test_forward_historian.py: 351-410
</a>
<div class="mid" id="frag814" style="display:none"><pre>
def test_log_topic(publish_agent, query_agent):
    """
    Test if log topic message is getting forwarded to historian running on
    another instance. Test if topic name substitutions happened.
    Publish to topic
    'datalogger/PNNL/BUILDING_1/Device' in volttron_instance1 and
    query for topic
    'datalogger/PNNL/BUILDING1_ANON/Device/MixedAirTemperature' in
    volttron_instance
    Expected result:
     Record should get entered into database with current time at time of
     insertion and should ignore timestamp in header. Topic name
     substitution should have happened
    @param publish_agent: Fake agent used to publish messages to bus in
    volttron_instance1. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance1 and forwareder
    agent and returns the  instance of fake agent to publish
    @param query_agent: Fake agent used to query sqlhistorian in
    volttron_instance. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance and sqlhistorian
    agent and returns the instance of a fake agent to query the historian
    """
    print("\n** test_log_topic **")
    # Publish fake data. The format mimics the format used by VOLTTRON drivers.
    # Make some random readings
    oat_reading = random.uniform(30, 100)
    mixed_reading = oat_reading + random.uniform(-5, 5)

    # Create a message for all points.
    message = {'MixedAirTemperature': {'Readings': mixed_reading,
                                       'Units': 'F',
                                       'tz': 'UTC',
                                       'type': 'float'}}
    # pytest.set_trace()
    # Create timestamp
    current_time = utils.format_timestamp(datetime.utcnow())
    print("current_time is ", current_time)
    future_time = '2017-12-02T00:00:00'
    headers = {
        headers_mod.DATE: future_time,
        headers_mod.TIMESTAMP: future_time
    }
    print("time in header is ", future_time)

    # Publish messages
    publish(publish_agent, "datalogger/PNNL/BUILDING_1/Device", headers, message)
    gevent.sleep(1)

    # Query the historian
    result = query_agent.vip.rpc.call(
        'platform.historian',
        'query',
        start=current_time,
        topic="datalogger/PNNL/BUILDING1_ANON/Device/MixedAirTemperature",
        order="LAST_TO_FIRST").get(timeout=10)
    print('Query Result', result)
    assert (len(result['values']) == 1)
    assert (result['values'][0][1] == approx(mixed_reading))


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 13:</b> &nbsp; 2 fragments, nominal size 21 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag631')" href="javascript:;">
volttron/services/core/DataMover/tests/test_datamover.py: 500-545
</a>
<div class="mid" id="frag631" style="display:none"><pre>
def test_log_topic_no_header(publish_agent, query_agent):
    """
    Test if log topic message is getting forwarded to historian running on
    another instance. Test if topic name substitutions happened.
    Publish to topic
    'datalogger/PNNL/BUILDING_1/Device' in volttron_instance1 and
    query for topic
    'datalogger/PNNL/BUILDING1_ANON/Device/MixedAirTemperature' in
    volttron_instance2
    :param publish_agent: Fake agent used to publish messages to bus in
    volttron_instance1. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance1 and forwareder
    agent and returns the  instance of fake agent to publish
    :param query_agent: Fake agent used to query sqlhistorian in
    volttron_instance2. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance2 and sqlhistorian
    agent and returns the instance of a fake agent to query the historian
    """
    print("\n** test_log_topic **")
    # Publish fake data. The format mimics the format used by VOLTTRON drivers.
    # Make some random readings
    oat_reading = random.uniform(30, 100)
    mixed_reading = oat_reading + random.uniform(-5, 5)
    current_time = datetime.utcnow().isoformat()
    # Create a message for all points.
    message = {'MixedAirTemperature': {'Readings': mixed_reading,
                                       'Units': 'F',
                                       'tz': 'UTC',
                                       'type': 'float'}}
    gevent.sleep(1)  # sleep so that there is no side effect from earlier test
    # Publish messages
    publish(publish_agent, "datalogger/PNNL/BUILDING_1/Device", None, message)
    gevent.sleep(0.5)

    # Query the historian
    result = query_agent.vip.rpc.call(
        'platform.historian',
        'query',
        topic="datalogger/PNNL/BUILDING1_ANON/Device/MixedAirTemperature",
        start=current_time,
        order="LAST_TO_FIRST").get(timeout=10)
    print('Query Result', result)
    assert (len(result['values']) == 1)
    assert (result['values'][0][1] == approx(mixed_reading))


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag815')" href="javascript:;">
volttron/services/core/ForwardHistorian/tests/test_forward_historian.py: 413-458
</a>
<div class="mid" id="frag815" style="display:none"><pre>
def test_log_topic_no_header(publish_agent, query_agent):
    """
    Test if log topic message is getting forwarded to historian running on
    another instance. Test if topic name substitutions happened.
    Publish to topic
    'datalogger/PNNL/BUILDING_1/Device' in volttron_instance1 and
    query for topic
    'datalogger/PNNL/BUILDING1_ANON/Device/MixedAirTemperature' in
    volttron_instance
    @param publish_agent: Fake agent used to publish messages to bus in
    volttron_instance1. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance1 and forwareder
    agent and returns the  instance of fake agent to publish
    @param query_agent: Fake agent used to query sqlhistorian in
    volttron_instance. Calling this fixture makes sure all the dependant
    fixtures are called to setup and start volttron_instance and sqlhistorian
    agent and returns the instance of a fake agent to query the historian
    """
    print("\n** test_log_topic **")
    # Publish fake data. The format mimics the format used by VOLTTRON drivers.
    # Make some random readings
    oat_reading = random.uniform(30, 100)
    mixed_reading = oat_reading + random.uniform(-5, 5)
    current_time = datetime.utcnow().isoformat()
    # Create a message for all points.
    message = {'MixedAirTemperature': {'Readings': mixed_reading,
                                       'Units': 'F',
                                       'tz': 'UTC',
                                       'type': 'float'}}
    gevent.sleep(1)  # sleep so that there is no side effect from earlier test
    # Publish messages
    publish(publish_agent, "datalogger/PNNL/BUILDING_1/Device", None, message)
    gevent.sleep(0.5)

    # Query the historian
    result = query_agent.vip.rpc.call(
        'platform.historian',
        'query',
        topic="datalogger/PNNL/BUILDING1_ANON/Device/MixedAirTemperature",
        start=current_time,
        order="LAST_TO_FIRST").get(timeout=10)
    print('Query Result', result)
    assert (len(result['values']) == 1)
    assert (result['values'][0][1] == approx(mixed_reading))


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 14:</b> &nbsp; 2 fragments, nominal size 34 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1048')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/platform_driver/interfaces/modbus_tk/tests/test_scale_reg.py: 49-102
</a>
<div class="mid" id="frag1048" style="display:none"><pre>
def agent(request, volttron_instance):
    """Build PlatformDriverAgent, add modbus driver &amp; csv configurations
    """

    # Build platform driver agent
    md_agent = volttron_instance.build_agent(identity="test_md_agent")
    capabilities = {'edit_config_store': {'identity': PLATFORM_DRIVER}}
    volttron_instance.add_capabilities(md_agent.core.publickey, capabilities)

    # Clean out platform driver configurations
    # wait for it to return before adding new config
    md_agent.vip.rpc.call('config.store',
                          'manage_delete_store',
                          PLATFORM_DRIVER).get()

    # Add driver configurations
    md_agent.vip.rpc.call('config.store',
                          'manage_store',
                          PLATFORM_DRIVER,
                          'devices/modbus_tk',
                          DRIVER_CONFIG_STRING,
                          config_type='json')

    # Add csv configurations
    md_agent.vip.rpc.call('config.store',
                          'manage_store',
                          PLATFORM_DRIVER,
                          'modbus_tk.csv',
                          REGISTRY_CONFIG_STRING,
                          config_type='csv')

    md_agent.vip.rpc.call('config.store',
                          'manage_store',
                          PLATFORM_DRIVER,
                          'modbus_tk_map.csv',
                          REGISTER_MAP,
                          config_type='csv')

    platform_uuid = volttron_instance.install_agent(agent_dir=get_services_core("PlatformDriverAgent"),
                                                   config_file={},
                                                   start=True)

    gevent.sleep(10)  # wait for the agent to start and start the devices

    def stop():
        """Stop platform driver agent
        """
        volttron_instance.stop_agent(platform_uuid)
        md_agent.core.stop()

    request.addfinalizer(stop)
    return md_agent


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1060')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/platform_driver/interfaces/modbus_tk/tests/test_scale_reg_pow_10.py: 49-102
</a>
<div class="mid" id="frag1060" style="display:none"><pre>
def agent(request, volttron_instance):
    """Build PlatformDriverAgent, add modbus driver &amp; csv configurations
    """

    # Build platform driver agent
    md_agent = volttron_instance.build_agent(identity="test_md_agent")
    capabilities = {'edit_config_store': {'identity': PLATFORM_DRIVER}}
    volttron_instance.add_capabilities(md_agent.core.publickey, capabilities)

    # Clean out platform driver configurations
    # wait for it to return before adding new config
    md_agent.vip.rpc.call('config.store',
                          'manage_delete_store',
                          PLATFORM_DRIVER).get()

    # Add driver configurations
    md_agent.vip.rpc.call('config.store',
                          'manage_store',
                          PLATFORM_DRIVER,
                          'devices/modbus_tk',
                          DRIVER_CONFIG_STRING,
                          config_type='json')

    # Add csv configurations
    md_agent.vip.rpc.call('config.store',
                          'manage_store',
                          PLATFORM_DRIVER,
                          'modbus_tk.csv',
                          REGISTRY_CONFIG_STRING,
                          config_type='csv')

    md_agent.vip.rpc.call('config.store',
                          'manage_store',
                          PLATFORM_DRIVER,
                          'modbus_tk_map.csv',
                          REGISTER_MAP,
                          config_type='csv')

    platform_uuid = volttron_instance.install_agent(agent_dir=get_services_core("PlatformDriverAgent"),
                                                   config_file={},
                                                   start=True)

    gevent.sleep(10)  # wait for the agent to start and start the devices

    def stop():
        """Stop platform driver agent
        """
        volttron_instance.stop_agent(platform_uuid)
        md_agent.core.stop()

    request.addfinalizer(stop)
    return md_agent


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 15:</b> &nbsp; 3 fragments, nominal size 6 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1056')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/platform_driver/interfaces/modbus_tk/tests/test_scale_reg.py: 172-181
</a>
<div class="mid" id="frag1056" style="display:none"><pre>
    def test_default_values(self, agent):
        """Set all default values to 0 and check reading those values."""
        self.revert_all(agent)

        default_values = self.scrape_all(agent)
        assert type(default_values) is dict

        for key in default_values.keys():
            assert default_values[key] == 0

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1068')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/platform_driver/interfaces/modbus_tk/tests/test_scale_reg_pow_10.py: 172-181
</a>
<div class="mid" id="frag1068" style="display:none"><pre>
    def test_default_values(self, agent):
        """Set all default values to 0 and check reading those values."""
        self.revert_all(agent)

        default_values = self.scrape_all(agent)
        assert type(default_values) is dict

        for key in default_values.keys():
            assert default_values[key] == 0

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1088')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/platform_driver/interfaces/modbus_tk/tests/test_write_single_registers.py: 168-178
</a>
<div class="mid" id="frag1088" style="display:none"><pre>
    def test_default_values(self, agent):
        """Test set default values
        """
        self.revert_all(agent)

        default_values = self.scrape_all(agent)
        assert type(default_values) is dict

        for key in default_values.keys():
            assert default_values[key] == 0

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 16:</b> &nbsp; 3 fragments, nominal size 6 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1059')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/platform_driver/interfaces/modbus_tk/tests/test_scale_reg.py: 203-211
</a>
<div class="mid" id="frag1059" style="display:none"><pre>
    def test_revert_all(self, agent):
        """Test revert device to default values."""
        self.revert_all(agent)

        default_values = self.scrape_all(agent)
        assert type(default_values) is dict

        for key in default_values.keys():
            assert default_values[key] == 0
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1092')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/platform_driver/interfaces/modbus_tk/tests/test_write_single_registers.py: 206-215
</a>
<div class="mid" id="frag1092" style="display:none"><pre>
    def test_revert_all(self, agent):
        """Test revert device to default values
        """
        self.revert_all(agent)

        default_values = self.scrape_all(agent)
        assert type(default_values) is dict

        for key in default_values.keys():
            assert default_values[key] == 0
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1071')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/platform_driver/interfaces/modbus_tk/tests/test_scale_reg_pow_10.py: 203-211
</a>
<div class="mid" id="frag1071" style="display:none"><pre>
    def test_revert_all(self, agent):
        """Test revert device to default values."""
        self.revert_all(agent)

        default_values = self.scrape_all(agent)
        assert type(default_values) is dict

        for key in default_values.keys():
            assert default_values[key] == 0
</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 17:</b> &nbsp; 2 fragments, nominal size 7 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1177')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/tests/test_device_groups.py: 78-92
</a>
<div class="mid" id="frag1177" style="display:none"><pre>
def subscriber_agent(volttron_instance):

    agent = volttron_instance.build_agent(
        identity="subscriber_agent", agent_class=_subscriber_agent
    )

    agent.vip.pubsub.subscribe(
        peer="pubsub", prefix=topics.DRIVER_TOPIC_BASE, callback=agent.add_result
    ).get()

    yield agent

    agent.core.stop()


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1190')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/tests/test_device_groups_p2.py: 167-181
</a>
<div class="mid" id="frag1190" style="display:none"><pre>
def subscriber_agent(volttron_instance):

    agent = volttron_instance.build_agent(
        identity="subscriber_agent", agent_class=_subscriber_agent
    )

    agent.vip.pubsub.subscribe(
        peer="pubsub", prefix=topics.DRIVER_TOPIC_BASE, callback=agent.add_result
    ).get()

    yield agent

    agent.core.stop()


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 18:</b> &nbsp; 3 fragments, nominal size 21 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1178')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/tests/test_device_groups.py: 124-163
</a>
<div class="mid" id="frag1178" style="display:none"><pre>
def test_agent(volttron_instance):
    """
    Build a test_agent, PlatformDriverAgent
    """

    # Build a test agent
    md_agent = volttron_instance.build_agent(identity="test_md_agent")
    gevent.sleep(1)

    if volttron_instance.auth_enabled:
        capabilities = {"edit_config_store": {"identity": PLATFORM_DRIVER}}
        volttron_instance.add_capabilities(md_agent.core.publickey, capabilities)

    # Clean out platform driver configurations
    # wait for it to return before adding new config
    md_agent.vip.rpc.call("config.store", "manage_delete_store", PLATFORM_DRIVER).get()

    # Add a fake.csv to the config store
    md_agent.vip.rpc.call(
        "config.store",
        "manage_store",
        PLATFORM_DRIVER,
        "fake.csv",
        registry_config_string,
        config_type="csv",
    ).get()

    # install the PlatformDriver
    platform_uuid = volttron_instance.install_agent(
        agent_dir=get_services_core("PlatformDriverAgent"), config_file={}, start=True
    )

    gevent.sleep(10)  # wait for the agent to start and start the devices

    yield md_agent

    volttron_instance.stop_agent(platform_uuid)
    md_agent.core.stop()


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1191')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/tests/test_device_groups_p2.py: 183-222
</a>
<div class="mid" id="frag1191" style="display:none"><pre>
def test_agent(volttron_instance):
    """
    Build a test_agent, PlatformDriverAgent
    """

    # Build a test agent
    md_agent = volttron_instance.build_agent(identity="test_md_agent")
    gevent.sleep(1)

    if volttron_instance.auth_enabled:
        capabilities = {"edit_config_store": {"identity": PLATFORM_DRIVER}}
        volttron_instance.add_capabilities(md_agent.core.publickey, capabilities)

    # Clean out platform driver configurations
    # wait for it to return before adding new config
    md_agent.vip.rpc.call("config.store", "manage_delete_store", PLATFORM_DRIVER).get()

    # Add a fake.csv to the config store
    md_agent.vip.rpc.call(
        "config.store",
        "manage_store",
        PLATFORM_DRIVER,
        "fake.csv",
        registry_config_string,
        config_type="csv",
    ).get()

    # install the PlatformDriver
    platform_uuid = volttron_instance.install_agent(
        agent_dir=get_services_core("PlatformDriverAgent"), config_file={}, start=True
    )

    gevent.sleep(10)  # wait for the agent to start and start the devices

    yield md_agent

    volttron_instance.stop_agent(platform_uuid)
    md_agent.core.stop()


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1250')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/tests/test_global_settings.py: 155-194
</a>
<div class="mid" id="frag1250" style="display:none"><pre>
def test_agent(volttron_instance):
    """
    Build a test_agent, PlatformDriverAgent
    """

    # Build a test agent
    md_agent = volttron_instance.build_agent(identity="test_md_agent")
    gevent.sleep(1)

    if volttron_instance.auth_enabled:
        capabilities = {"edit_config_store": {"identity": PLATFORM_DRIVER}}
        volttron_instance.add_capabilities(md_agent.core.publickey, capabilities)

    # Clean out platform driver configurations
    # wait for it to return before adding new config
    md_agent.vip.rpc.call("config.store", "manage_delete_store", PLATFORM_DRIVER).get()

    # Add a fake.csv to the config store
    md_agent.vip.rpc.call(
        "config.store",
        "manage_store",
        PLATFORM_DRIVER,
        "fake.csv",
        registry_config_string,
        config_type="csv",
    ).get()

    # install the PlatformDriver
    platform_uuid = volttron_instance.install_agent(
        agent_dir=get_services_core("PlatformDriverAgent"), config_file={}, start=True
    )

    gevent.sleep(10)  # wait for the agent to start and start the devices

    yield md_agent

    volttron_instance.stop_agent(platform_uuid)
    md_agent.core.stop()


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 19:</b> &nbsp; 3 fragments, nominal size 11 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1179')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/tests/test_device_groups.py: 164-176
</a>
<div class="mid" id="frag1179" style="display:none"><pre>
def setup_config(test_agent, config_name, config_string, **kwargs):
    config = config_string.format(**kwargs)
    print("Adding", config_name, "to store")
    test_agent.vip.rpc.call(
        "config.store",
        "manage_store",
        PLATFORM_DRIVER,
        config_name,
        config,
        config_type="json",
    ).get()


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1192')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/tests/test_device_groups_p2.py: 223-235
</a>
<div class="mid" id="frag1192" style="display:none"><pre>
def setup_config(test_agent, config_name, config_string, **kwargs):
    config = config_string.format(**kwargs)
    print("Adding", config_name, "to store")
    test_agent.vip.rpc.call(
        "config.store",
        "manage_store",
        PLATFORM_DRIVER,
        config_name,
        config,
        config_type="json",
    ).get()


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1251')" href="javascript:;">
volttron/services/core/PlatformDriverAgent/tests/test_global_settings.py: 195-207
</a>
<div class="mid" id="frag1251" style="display:none"><pre>
def setup_config(test_agent, config_name, config_string, **kwargs):
    config = config_string.format(**kwargs)
    print("Adding", config_name, "to store")
    test_agent.vip.rpc.call(
        "config.store",
        "manage_store",
        PLATFORM_DRIVER,
        config_name,
        config,
        config_type="json",
    ).get()


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 20:</b> &nbsp; 2 fragments, nominal size 5 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag1319')" href="javascript:;">
volttron/services/core/VolttronCentral/tests/test_platforms.py: 11-17
</a>
<div class="mid" id="frag1319" style="display:none"><pre>
def mock_vc():
    VolttronCentralAgent.__bases__ = (AgentMock.imitate(Agent, VolttronCentralAgent()),)
    vc = VolttronCentralAgent()
    vc._configure("test_config", "NEW", {})
    yield vc


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag1323')" href="javascript:;">
volttron/services/core/VolttronCentral/tests/test_vc.py: 62-68
</a>
<div class="mid" id="frag1323" style="display:none"><pre>
def mock_vc():
    VolttronCentralAgent.__bases__ = (AgentMock.imitate(Agent, VolttronCentralAgent()),)
    vc = VolttronCentralAgent()
    vc._configure("test_config", "NEW", {})
    yield vc


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 21:</b> &nbsp; 2 fragments, nominal size 5 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2092')" href="javascript:;">
volttron/volttron/platform/upgrade/move_sqlite_files.py: 51-59
</a>
<div class="mid" id="frag2092" style="display:none"><pre>
def get_aip():
    """Get AIPplatform to interface with agent directories in vhome"""

    vhome = get_home()
    options = type("Options", (), dict(volttron_home=vhome))
    aip = AIPplatform(options)
    return aip


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2099')" href="javascript:;">
volttron/volttron/platform/upgrade/update_auth_file.py: 49-57
</a>
<div class="mid" id="frag2099" style="display:none"><pre>
def get_aip():
    """Get AIPplatform to interface with agent directories in vhome"""

    vhome = get_home()
    options = type("Options", (), dict(volttron_home=vhome))
    aip = AIPplatform(options)
    return aip


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 22:</b> &nbsp; 4 fragments, nominal size 5 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2095')" href="javascript:;">
volttron/volttron/platform/upgrade/move_sqlite_files.py: 105-113
</a>
<div class="mid" id="frag2095" style="display:none"><pre>
def _main():
    """ Wrapper for main function"""

    try:
        sys.exit(main())
    except KeyboardInterrupt:
        sys.exit(1)


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2107')" href="javascript:;">
volttron/volttron/platform/upgrade/upgrade_volttron.py: 63-69
</a>
<div class="mid" id="frag2107" style="display:none"><pre>
def _main():
    """ Wrapper for main function"""
    try:
        sys.exit(main())
    except KeyboardInterrupt:
        sys.exit(1)

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2098')" href="javascript:;">
volttron/volttron/platform/upgrade/rename_config_for_agent_isolation.py: 65-72
</a>
<div class="mid" id="frag2098" style="display:none"><pre>
def _main():
    """ Wrapper for main function"""
    try:
        sys.exit(main())
    except KeyboardInterrupt:
        sys.exit(1)


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2105')" href="javascript:;">
volttron/volttron/platform/upgrade/update_auth_file.py: 156-164
</a>
<div class="mid" id="frag2105" style="display:none"><pre>
def _main():
    """ Wrapper for main function"""

    try:
        sys.exit(main())
    except KeyboardInterrupt:
        sys.exit(1)


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 23:</b> &nbsp; 4 fragments, nominal size 6 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2196')" href="javascript:;">
volttron/volttron/platform/vip/agent/subsystems/hello.py: 123-128
</a>
<div class="mid" id="frag2196" style="display:none"><pre>
    def _handle_error(self, sender, message, error, **kwargs):
        try:
            result = self._results.pop(message.id)
        except KeyError:
            return
        result.set_exception(error)
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2203')" href="javascript:;">
volttron/volttron/platform/vip/agent/subsystems/peerlist.py: 173-178
</a>
<div class="mid" id="frag2203" style="display:none"><pre>
    def _handle_error(self, sender, message, error, **kwargs):
        try:
            result = self._results.pop(message.id)
        except KeyError:
            return
        result.set_exception(error)
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2211')" href="javascript:;">
volttron/volttron/platform/vip/agent/subsystems/query.py: 92-97
</a>
<div class="mid" id="frag2211" style="display:none"><pre>
    def _handle_error(self, sender, message, error, **kwargs):
        try:
            result = self._results.pop(message.id)
        except KeyError:
            return
        result.set_exception(error)
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2207')" href="javascript:;">
volttron/volttron/platform/vip/agent/subsystems/ping.py: 100-105
</a>
<div class="mid" id="frag2207" style="display:none"><pre>
    def _handle_error(self, sender, message, error, **kwargs):
        try:
            result = self._results.pop(message.id)
        except KeyError:
            return
        result.set_exception(error)
</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 24:</b> &nbsp; 2 fragments, nominal size 7 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2487')" href="javascript:;">
volttron/volttrontesting/platform/auth_tests/conftest.py: 1-7
</a>
<div class="mid" id="frag2487" style="display:none"><pre>
def assert_auth_entries_same(e1, e2):
    for field in ['domain', 'address', 'user_id', 'credentials', 'comments',
                  'enabled']:
        assert e1[field] == e2[field]
    for field in ['roles', 'groups']:
        assert set(e1[field]) == set(e2[field])
    assert e1['capabilities'] == e2['capabilities']
</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2497')" href="javascript:;">
volttron/volttrontesting/platform/auth_tests/test_auth_control.py: 174-182
</a>
<div class="mid" id="frag2497" style="display:none"><pre>
def assert_auth_entries_same(e1, e2):
    for field in ['domain', 'address', 'user_id', 'credentials', 'comments',
                  'enabled']:
        assert e1[field] == e2[field]
    for field in ['roles', 'groups']:
        assert set(e1[field]) == set(e2[field])
    assert e1['capabilities'] == e2['capabilities']


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 25:</b> &nbsp; 2 fragments, nominal size 9 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2588')" href="javascript:;">
volttron/volttrontesting/platform/base_market_agent/test_poly_line.py: 155-165
</a>
<div class="mid" id="frag2588" style="display:none"><pre>
def create_supply_curve():
    supply_curve = PolyLine()
    price = 0
    quantity = 0
    supply_curve.add(Point(price,quantity))
    price = 1000
    quantity = 1000
    supply_curve.add(Point(price,quantity))
    return supply_curve


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2593')" href="javascript:;">
volttron/volttrontesting/platform/base_market_agent/test_poly_line_factory.py: 82-92
</a>
<div class="mid" id="frag2593" style="display:none"><pre>
def create_supply_curve():
    supply_curve = PolyLine()
    price = 0
    quantity = 0
    supply_curve.add(Point(price,quantity))
    price = 1000
    quantity = 1000
    supply_curve.add(Point(price,quantity))
    return supply_curve


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 26:</b> &nbsp; 3 fragments, nominal size 7 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2760')" href="javascript:;">
volttron/volttrontesting/services/historian/test_base_historian.py: 79-88
</a>
<div class="mid" id="frag2760" style="display:none"><pre>
    def remove_backup_cache_db(self):
        try:
            print(f"Removing backup cache  {self.backup_sqlite}")
            os.remove(str(self.backup_sqlite))
            os.remove(str(self.agent_data_dir))
        except:
            print("Don't throw here if os.remove fails...")



</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2765')" href="javascript:;">
volttron/volttrontesting/services/historian/test_base_historian.py: 119-128
</a>
<div class="mid" id="frag2765" style="display:none"><pre>
    def remove_backup_cache_db(self):
        try:
            print(f"Removing backup cache  {self.backup_sqlite}")
            os.remove(str(self.backup_sqlite))
            os.remove(str(self.agent_data_dir))
        except:
            print("Don't throw here if os.remove fails...")



</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2777')" href="javascript:;">
volttron/volttrontesting/services/historian/test_base_historian.py: 570-577
</a>
<div class="mid" id="frag2777" style="display:none"><pre>
    def remove_backup_cache_db(self):
        try:
            print(f"Removing backup cache  {self.backup_sqlite}")
            os.remove(str(self.backup_sqlite))
            os.remove(str(self.agent_data_dir))
        except:
            print("Don't throw here if os.remove fails...")

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 27:</b> &nbsp; 2 fragments, nominal size 9 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2898')" href="javascript:;">
volttron/volttrontesting/zmq/test_zmq.py: 52-62
</a>
<div class="mid" id="frag2898" style="display:none"><pre>
def broker():
    pub = zmq.Socket(ctx, zmq.PUB)
    pull = zmq.Socket(ctx, zmq.PULL)
    pub.bind('ipc:///tmp/volttron-platform-agent-subscribe')
    pull.bind('ipc:///tmp/volttron-platform-agent-publish')
    while True:
        message = pull.recv_multipart()
        print(message)
        pub.send_multipart(message)


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2902')" href="javascript:;">
volttron/volttrontesting/zmq/test_zmqsub.py: 51-61
</a>
<div class="mid" id="frag2902" style="display:none"><pre>
def broker():
    pub = zmq.Socket(ctx, zmq.PUB)
    pull = zmq.Socket(ctx, zmq.PULL)
    pub.bind('ipc:///tmp/volttron-platform-agent-subscribe')
    pull.bind('ipc:///tmp/volttron-platform-agent-publish')
    while True:
        message = pull.recv_multipart()
        print(message)
        pub.send_multipart(message)


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 28:</b> &nbsp; 2 fragments, nominal size 11 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2899')" href="javascript:;">
volttron/volttrontesting/zmq/test_zmq.py: 63-75
</a>
<div class="mid" id="frag2899" style="display:none"><pre>
def publisher():
    push = zmq.Socket(ctx, zmq.PUSH)
    push.connect('ipc:///tmp/volttron-platform-agent-publish')
    while True:
        sys.stdout.write('Topic: ')
        sys.stdout.flush()
        topic = sys.stdin.readline()
        sys.stdout.write('Message: ')
        sys.stdout.flush()
        message = sys.stdin.readline()
        push.send_multipart([topic, message])


</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2903')" href="javascript:;">
volttron/volttrontesting/zmq/test_zmqsub.py: 62-74
</a>
<div class="mid" id="frag2903" style="display:none"><pre>
def publisher():
    push = zmq.Socket(ctx, zmq.PUSH)
    push.connect('ipc:///tmp/volttron-platform-agent-publish')
    while True:
        sys.stdout.write('Topic: ')
        sys.stdout.flush()
        topic = sys.stdin.readline()
        sys.stdout.write('Message: ')
        sys.stdout.flush()
        message = sys.stdin.readline()
        push.send_multipart([topic, message])


</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<br>
<table style="width:1000px; border:2px solid lightgrey; border-radius:8px;">
<tr><td style="background-color:white">
<p style="font-size:14pt"><b>Class 29:</b> &nbsp; 2 fragments, nominal size 6 lines, similarity 100%</p>
<table cellpadding=4 border=2>
<tr>
<td width="auto">
<a onclick="javascript:ShowHide('frag2900')" href="javascript:;">
volttron/volttrontesting/zmq/test_zmq.py: 76-82
</a>
<div class="mid" id="frag2900" style="display:none"><pre>
def subscriber():
    sub = zmq.Socket(ctx, zmq.SUB)
    sub.connect('ipc:///tmp/volttron-platform-agent-subscribe')
    sub.subscribe = ''
    while True:
        print(sub.recv_multipart())

</pre></div>
</td>
<td width="auto">
<a onclick="javascript:ShowHide('frag2904')" href="javascript:;">
volttron/volttrontesting/zmq/test_zmqsub.py: 75-81
</a>
<div class="mid" id="frag2904" style="display:none"><pre>
def subscriber():
    sub = zmq.Socket(ctx, zmq.SUB)
    sub.connect('ipc:///tmp/volttron-platform-agent-subscribe')
    sub.subscribe = ''
    while True:
        print(sub.recv_multipart())

</pre></div>
</td>
</tr><tr>
</tr>
</table>
</td></tr>
</table>
<script language="JavaScript">
function ShowHide(divId) { 
    if(document.getElementById(divId).style.display == 'none') {
        document.getElementById(divId).style.display='block';
    } else { 
        document.getElementById(divId).style.display = 'none';
    } 
}
</script>
</body>
</html>
